{% extends 'base.html' %}
{% load static %}
{% load render_partial %}

{% block title %}Ø¨Ø¯Ù‡ Ø¨Ø³ØªÙˆÙ† - ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ{% endblock %}
{% block style_tag %}
    <style>
    div.success-box
    {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #3fb33f;
    color: white;
    padding: 15px 25px;
    border-radius: 5px;
    font-size: 16px;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
    opacity: 1;
    transition: opacity 0.5s ease-in-out;
    z-index: 9999;}
    </style>
{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{% static "Spends/Style/dashboard.css" %}">
{% endblock %}


{% block content %}
    {% if messages %}
        {% for msg in messages %}
            {% if msg.tags == "success" %}
                <div class="success-box" id="error-message">
                    {{ msg }}
                </div>
            {% elif msg.tags == "error" %}
                <div class="error-box" id="error-message">
                    {{ msg }}
                </div>
            {% endif %}
        {% endfor %}
    {% endif %}

    <div class="container">
    <h1>Ø¹Ø²ÛŒØ²ØŒ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!{{ username }}</h1>

    <div class="filter-box">
            <form method="post">
                <div>
                {% csrf_token %}
                <label for="time-filter-expenses">ÙÛŒÙ„ØªØ± Ø²Ù…Ø§Ù† Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§:</label>
                <select name="spend_time_filter" id="time-filter-expenses">
                    <option selected value="select">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
                    <option {% if spend_filter == "all" %}selected{% endif %}  name="all" value="all">Ù‡Ù…Ù‡</option>
                    <option {% if spend_filter == "last_ten" %}selected{% endif %} name="last_ten" value="last_ten">Û±Û° Ø®Ø±Ø¬ Ø¢Ø®Ø±</option>
                    <option {% if spend_filter == "week" %}selected{% endif %} name="week" value="week">Ù‡ÙØªÙ‡ Ú¯Ø°Ø´ØªÙ‡</option>
                    <option {% if spend_filter == "month" %}selected{% endif %} name="month" value="month">Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡</option>
                    <option {% if spend_filter == "year" %}selected{% endif %} name="year" value="year">Ø³Ø§Ù„ Ú¯Ø°Ø´ØªÙ‡</option>
                </select>
                </div>
                <br>
                <div>
                <label for="time-filter-incomes">ÙÛŒÙ„ØªØ± Ø²Ù…Ø§Ù† Ø¯Ø±Ø¢Ù…Ø¯Ù‡Ø§:</label>
                <select name="income_time_filter" id="time-filter-incomes">
                    <option selected value="select">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
                    <option {% if income_filter == "all" %}selected{% endif %} value="all">Ù‡Ù…Ù‡</option>
                    <option {% if income_filter == "last_ten" %}selected{% endif %}  value="last_ten">Û±Û° Ø¯Ø±Ø¢Ù…Ø¯ Ø¢Ø®Ø±</option>
                    <option {% if income_filter == "week" %}selected{% endif %} value="week">Ù‡ÙØªÙ‡ Ú¯Ø°Ø´ØªÙ‡</option>
                    <option {% if income_filter == "month" %}selected{% endif %} value="month">Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡</option>
                    <option {% if income_filter == "year" %}selected{% endif %} value="year">Ø³Ø§Ù„ Ú¯Ø°Ø´ØªÙ‡</option>
                </select>
                </div>
                <br>
                <button type="submit" id="filter-btn">Ù†Ù…Ø§ÛŒØ´</button>

        </form>

    </div>

    <div class="panel">
        <div class="section expenses">
            <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</h2>
            <button class="add-btn"><a class="link" href="{% url 'add_spend' %}">+ Ø§ÙØ²ÙˆØ¯Ù† Ø®Ø±Ø¬</a></button>
            <ul class="list">
            {% if spends %}
                    {% for spend in spends %}
                        <li><a href="{{ spend.get_absolute_url }}">{{ spend.title }} | {{ spend.price }}</a></li>
                    {% endfor %}
            {% else %}
                <p class="empty-alert">Ù…ÙˆØ±Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù†Ù…ÛŒ Ø¨Ø§Ø´Ø¯!</p>
            {% endif %}
            </ul>
            <div class="highlight highest"><span class="icon">ğŸ’¸</span>Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ø®Ø±Ø¬: {{ max_spend }} ØªÙˆÙ…Ø§Ù†</div>
            <div class="highlight lowest"><span class="icon">ğŸ›’</span>Ú©Ù…ØªØ±ÛŒÙ† Ø®Ø±Ø¬: {{ min_spend }} ØªÙˆÙ…Ø§Ù†</div>
            <div class="highlight average">
               <span class="icon">ğŸ“Š</span>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø®Ø±Ø¬: {{ avg_spend }} ØªÙˆÙ…Ø§Ù†
            </div>
        </div>

        <div class="section incomes">
            <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ø¢Ù…Ø¯Ù‡Ø§</h2>
            <button class="add-btn"><a class="link" href="{% url 'add_income' %}">Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ø¢Ù…Ø¯</a></button>
            <ul class="list">
                {% if incomes %}
                    {% for income in incomes %}
                        <li><a href="{{ income.get_absolute_url }}">{{ income.title }} | {{ income.price }}</a></li>
                    {% endfor %}
                {% else %}
                    <p class="empty-alert">Ù…ÙˆØ±Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù†Ù…ÛŒ Ø¨Ø§Ø´Ø¯!</p>
                {% endif %}
            </ul>
            <div class="highlight highest"><span class="icon">ğŸ’°</span>Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ø¯Ø±Ø¢Ù…Ø¯: {{ max_income }} ØªÙˆÙ…Ø§Ù†</div>
            <div class="highlight lowest"><span class="icon">ğŸ</span>Ú©Ù…ØªØ±ÛŒÙ† Ø¯Ø±Ø¢Ù…Ø¯: {{ min_income }} ØªÙˆÙ…Ø§Ù†</div>
            <div class="highlight average">
            <span class="icon">ğŸ“Š</span>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø¯Ø±Ø¢Ù…Ø¯: {{ avg_income }} ØªÙˆÙ…Ø§Ù†
            </div>
        </div>
    </div>
</div>

    {% render_partial "Spends.views.chart" %}
    {% render_partial "Spends.views.profit_or_loss" %}
{% endblock %}
{% block js %}
    <script src="{% static 'Spends/Js/register.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

